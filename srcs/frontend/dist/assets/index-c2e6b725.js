(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();let $=null;const U={};function Qe(t,e){U[t]&&U[t].forEach(n=>n(e))}function Ie(t,e){return U[t]||(U[t]=[]),U[t].push(e),()=>{U[t]=U[t].filter(n=>n!==e)}}function Me(){if($&&$.readyState===WebSocket.OPEN){console.log("WebSocket already connected.");return}const e=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/tournaments/ws`;console.log(`Connecting to WebSocket at ${e}`),$=new WebSocket(e),$.onopen=()=>{console.log("WebSocket connection established.")},$.onclose=()=>{console.log("WebSocket connection closed. Attempting to reconnect..."),$=null,setTimeout(Me,3e3)},$.onerror=n=>{console.error("WebSocket error:",n)},$.onmessage=n=>{try{const a=JSON.parse(n.data);console.log("[WS] Received:",a),a.type?Qe(a.type,a.data||a):console.warn("[WS] Received message without a type:",a)}catch(a){console.error("[WS] Error parsing incoming message:",a)}}}function Q(t){if(!$||$.readyState!==WebSocket.OPEN){console.error("WebSocket is not connected. Cannot send message:",t);return}$.send(JSON.stringify(t))}function Ze(t,e){Q({type:"create_tournament",name:t,owner_id:e})}function Tt(t){Q({type:"delete_tournament",name:t})}function Pt(t){Q({type:"get_tournament_details",tournament_id:t})}function Le(t,e){Q({type:"join_tournament",tournament_id:t,user_id:e})}function $t(t,e){Q({type:"leave_tournament",tournament_id:t,user_id:e})}function Dt(t){Q({type:"start_tournament",name:t})}async function F(t,e){const n=await fetch(t,e);if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}function K(t){t.classList.remove("hidden")}function I(t){t.classList.add("hidden")}const Ae={home:[],login:[],game:[],tournament:[],friends:[],profile:[],"play-ai":[],"play-pvp":[],"change-password":[],publicProfile:[],signup:[],"setup-2fa":[]};function C(t,e){Ae[t].push(e)}function p(t,e){const n=e&&e.id?`#${t}/${e.id}`:`#${t}`;history.pushState({view:t,params:e},"",n),Ne(t,e)}function Ne(t,e){(Ae[t]||[]).forEach(a=>a(e))}window.addEventListener("popstate",t=>{const e=t.state;e&&Ne(e.view,e.params)});function Xe(){const t=document.getElementById("login-btn"),e=document.getElementById("login-modal"),n=document.getElementById("login-modal-form"),a=document.getElementById("login-modal-close"),i=document.getElementById("login-email"),r=document.getElementById("login-password"),o=document.getElementById("google-login-btn"),s=document.getElementById("guest-login-btn");if(!t||!e||!n||!a||!i||!r||!o||!s)return;const d=()=>{e&&I(e),p("home")};t.addEventListener("click",l=>{l.preventDefault(),K(e),p("login")}),a.addEventListener("click",l=>{l.preventDefault(),d()}),e.addEventListener("click",l=>{l.target===e&&d()}),document.addEventListener("keydown",l=>{l.key==="Escape"&&e&&!e.classList.contains("hidden")&&d()}),C("home",()=>{e&&!e.classList.contains("hidden")&&I(e)}),n.addEventListener("submit",async l=>{l.preventDefault();const c=i.value,m=r.value;try{(await fetch("/api/auth/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,password:m})})).ok?(I(e),window.location.reload()):alert("Login failed")}catch(u){console.error(u),alert("Login error")}}),o.addEventListener("click",l=>{l.preventDefault(),window.location.href="/api/auth/login/google"}),s.addEventListener("click",async l=>{l.preventDefault();try{(await fetch("/api/auth/guest",{method:"POST",credentials:"include"})).ok?(I(e),window.location.reload()):alert("Guest login failed")}catch(c){console.error(c),alert("Guest login error")}})}const et="modulepreload",tt=function(t){return"/"+t},be={},me=function(e,n,a){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=tt(r),r in be)return;be[r]=!0;const o=r.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(!!a)for(let c=i.length-1;c>=0;c--){const m=i[c];if(m.href===r&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${s}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":et,o||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),o)return new Promise((c,m)=>{l.addEventListener("load",c),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})};function nt(){const t=document.getElementById("2fa-setup-modal"),e=document.getElementById("2fa-setup-close"),n=document.getElementById("2fa-setup-qr"),a=document.getElementById("2fa-setup-testcode"),i=document.getElementById("2fa-setup-form"),r=document.getElementById("2fa-setup-code");if(!t||!e||!n||!i||!r)return;async function o(){try{const s=await fetch("/api/auth/2fa/setup/ask",{method:"GET",credentials:"include"});if(!s.ok){const l=await s.json().catch(()=>({}));alert(l.error||"Failed to initiate 2FA setup");return}const d=await s.json();n.src=d.qrCode,a&&d.testCode&&(a.textContent=`Test code: ${d.testCode}`,K(a)),K(t)}catch(s){console.error("2FA setup ask error:",s),alert("Error initiating 2FA setup")}}C("setup-2fa",o),e.addEventListener("click",s=>{s.preventDefault(),p("home")}),t.addEventListener("click",s=>{s.target===t&&p("home")}),document.addEventListener("keydown",s=>{s.key==="Escape"&&!t.classList.contains("hidden")&&p("home")}),C("home",()=>{t&&!t.classList.contains("hidden")&&I(t)}),i.addEventListener("submit",async s=>{s.preventDefault();const d=r.value.trim();if(!/^\d{6}$/.test(d)){alert("Please enter a valid 6-digit code.");return}try{const l=await fetch("/api/auth/2fa/setup/submit",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({userToken:d})}),c=await l.json().catch(()=>({}));l.ok?(alert("2FA has been successfully enabled. You will now be logged out. Please log in again to continue."),I(t),a&&I(a),localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),localStorage.removeItem("userEmail"),localStorage.removeItem("twofaEnabled"),window.location.reload()):alert(c.error||"2FA setup verification failed")}catch(l){console.error("2FA setup submit error:",l),alert("Error verifying 2FA code")}})}function _e(){const t=document.getElementById("2fa-login-modal"),e=document.getElementById("2fa-login-close"),n=document.getElementById("2fa-login-form"),a=document.getElementById("2fa-login-code");if(!t||!e||!n||!a)return{show2faLogin:()=>{}};function i(){K(t)}return e.addEventListener("click",r=>{r.preventDefault(),I(t)}),t.addEventListener("click",r=>{r.target===t&&I(t)}),n.addEventListener("submit",async r=>{r.preventDefault();const o=a.value.trim();try{const s=await fetch("/api/auth/2fa/submit",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({userToken:o})}),d=await s.json().catch(()=>({}));s.ok?(I(t),localStorage.setItem("loggedIn","true"),window.location.replace(`${location.pathname}${location.search}`)):alert(d.error||"2FA verification failed")}catch(s){console.error("2FA login error:",s),alert("Error verifying 2FA login")}}),{show2faLogin:i}}const B=document.getElementById("public-profile-modal"),ke=document.getElementById("public-profile-close"),ee=document.getElementById("public-profile-name"),Be=document.getElementById("public-profile-email"),te=document.getElementById("public-profile-avatar"),b=document.getElementById("public-profile-add-btn");let oe=null;async function pe(t){var e;if(!B||!ee||!Be||!te||!b){console.error("Public profile modal elements not found");return}try{const n=await F(`/api/user/search/${t}`,{credentials:"include"});if(!n.success||!n.profile){alert(n.msg||"User not found");return}const a=n.profile;oe=a.id,ee.textContent="";const i=document.createTextNode(a.name);ee.appendChild(i);const r=document.createElement("span");r.className="text-gray-400 text-sm ml-1",r.textContent=`#${a.tag}`,ee.appendChild(r),Be.textContent=a.email,a.avatar?(te.src=a.avatar,te.classList.remove("hidden")):te.classList.add("hidden");const o=await F(`/api/user/friends/status/${a.id}`,{credentials:"include"});o.status==="friends"?(b.textContent="Friends",b.disabled=!1):o.status==="pending_sent"?(b.textContent="Cancel Request",b.disabled=!1):(b.textContent="Add Friend",b.disabled=!1);const s=localStorage.getItem("userId");!localStorage.getItem("userEmail")||s&&parseInt(s,10)===a.id?b.classList.add("hidden"):b.classList.remove("hidden"),(e=document.getElementById("friends-modal"))==null||e.classList.add("hidden"),B.classList.remove("hidden"),p("publicProfile",{id:a.id})}catch(n){console.error("Fetch public profile failed:",n),alert("Failed to load user profile")}}function ie(){B&&B.classList.add("hidden"),p("home")}function ot(){!B||!ke||!b||(ke.addEventListener("click",t=>{t.preventDefault(),ie()}),B.addEventListener("click",t=>{t.target===B&&ie()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&!B.classList.contains("hidden")&&ie()}),C("home",()=>{B&&!B.classList.contains("hidden")&&B.classList.add("hidden")}),b.addEventListener("click",async()=>{if(!oe)return;const t=b.textContent;if(t==="Add Friend")try{const e=await F(`/api/user/friends/requests/${oe}`,{method:"POST",credentials:"include"});e.success?b.textContent="Cancel Request":alert(e.error||e.msg||"Failed to send friend request")}catch(e){console.error("Send friend request error:",e),alert("Error sending friend request")}else if(t==="Cancel Request")try{const e=await F(`/api/user/friends/requests/${oe}`,{method:"DELETE",credentials:"include"});e.success?b.textContent="Add Friend":alert(e.error||e.msg||"Failed to cancel friend request")}catch(e){console.error("Cancel friend request error:",e),alert("Error canceling friend request")}else if(t==="Friends"){B&&B.classList.add("hidden");const e=document.getElementById("friends-modal");e&&(e.classList.remove("hidden"),p("friends"))}}))}function at(){const t=document.getElementById("friends-btn"),e=document.getElementById("friends-modal"),n=document.getElementById("friends-modal-close"),a=document.getElementById("friends-list"),i=document.getElementById("friend-requests-list"),r=document.getElementById("friends-badge");if(!t||!e||!n||!a||!i||!r)return;async function o(){a.innerHTML="",i.innerHTML="";try{(await F("/api/user/friends",{credentials:"include"})).forEach(l=>{const c=document.createElement("li");c.className="flex items-center justify-between px-2 py-1 bg-gray-700 rounded cursor-pointer";const m=document.createElement("span");m.textContent=l.name;const u=document.createElement("span");u.className=`w-3 h-3 rounded-full ${l.status==="online"?"bg-green-500":"bg-gray-500"}`;const f=document.createElement("div");f.className="flex items-center gap-2",f.appendChild(u),f.appendChild(m),c.appendChild(f),c.addEventListener("click",w=>{w.stopPropagation(),pe(l.id)}),a.appendChild(c)}),(await F("/api/user/receivedFriendRequests",{credentials:"include"})).forEach(l=>{const c=document.createElement("li");c.className="flex items-center justify-between px-2 py-1 bg-gray-700 rounded";const m=document.createElement("span");m.textContent=l.name,m.className="cursor-pointer",m.addEventListener("click",h=>{h.stopPropagation(),pe(l.id)});const u=document.createElement("button");u.textContent="Accept",u.className="px-2 py-1 bg-green-500 rounded text-white text-sm",u.addEventListener("click",async()=>{try{const h=await fetch(`/api/user/friends/requests/${l.id}`,{method:"PUT",credentials:"include"}),L=await h.json();h.ok&&L.success?(c.remove(),ae()):alert(L.error||L.msg||"Failed to accept friend request")}catch(h){console.error(h),alert("Error accepting request")}});const f=document.createElement("button");f.textContent="Reject",f.className="px-2 py-1 bg-red-500 rounded text-white text-sm",f.addEventListener("click",async()=>{try{const h=await fetch(`/api/user/friends/requests/${l.id}`,{method:"DELETE",credentials:"include"}),L=await h.json();h.ok&&L.success?(c.remove(),ae()):alert(L.error||L.msg||"Failed to reject friend request")}catch(h){console.error(h),alert("Error rejecting request")}});const w=document.createElement("div");w.className="flex gap-2",w.append(u,f),c.append(m,w),i.appendChild(c)}),K(e),ae()}catch(s){console.error("Error loading friends data",s)}}t.addEventListener("click",s=>{s.preventDefault(),p("friends"),o()}),window.addEventListener("popstate",s=>{const d=s.state;d&&d.view==="friends"?o():e&&I(e)}),location.hash==="#friends"&&o(),n.addEventListener("click",s=>{s.preventDefault(),p("home")}),e.addEventListener("click",s=>{s.target===e&&p("home")}),document.addEventListener("keydown",s=>{s.key==="Escape"&&!e.classList.contains("hidden")&&p("home")}),C("home",()=>{e&&!e.classList.contains("hidden")&&I(e)})}async function ae(){const t=document.getElementById("friends-badge");if(t)try{const n=(await F("/api/user/receivedFriendRequests",{credentials:"include"})).length;n>0?(t.textContent=n.toString(),t.classList.remove("hidden")):t.classList.add("hidden")}catch(e){console.error("Failed to update friends badge",e)}}const{show2faLogin:st}=_e(),le=document.getElementById("auth-user"),de=document.getElementById("auth-guest"),Se=document.getElementById("logout-btn"),se=document.getElementById("user-greeting");function ce(){const t=localStorage.getItem("userId");if(!t)return null;const e=parseInt(t,10);return isNaN(e)?null:e}function he(){if(!le||!de||!se)return;localStorage.getItem("loggedIn")==="true"?(le.classList.remove("hidden"),de.classList.add("hidden"),se.textContent=localStorage.getItem("username")||"Player"):(le.classList.add("hidden"),de.classList.remove("hidden"))}async function je(){try{const t=await fetch("/api/auth/status",{credentials:"include"}),e=await t.json();if(t.ok){if(localStorage.setItem("loggedIn","true"),e.name&&localStorage.setItem("username",e.name),e.email)localStorage.setItem("userEmail",e.email);else{const n=document.getElementById("profile-btn"),a=document.getElementById("friends-btn");n&&n.classList.add("hidden"),a&&a.classList.add("hidden")}localStorage.setItem("twofaEnabled",e.twofaEnabled===!0?"true":"false")}else t.status===403&&e.error==="Two-factor authentication required"&&st(),localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),localStorage.removeItem("twofaEnabled")}catch(t){console.error("Auth status check failed",t),localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),localStorage.removeItem("twofaEnabled")}if(he(),localStorage.getItem("loggedIn")==="true"){const t=localStorage.getItem("userEmail");if(t)try{const e=await fetch(`/api/user/search/${encodeURIComponent(t)}`,{credentials:"include"});if(e.ok){const n=await e.json();n.success&&n.profile&&(se&&(se.textContent=`${n.profile.name}`),localStorage.setItem("userId",n.profile.id.toString()))}}catch(e){console.error("Greeting profile fetch failed:",e)}}ae().catch(console.error)}Se&&Se.addEventListener("click",async t=>{t.preventDefault();try{await fetch("/api/auth/logout",{method:"DELETE",credentials:"include"})}catch(e){console.error("Logout request failed",e)}localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("authMethod"),he()});async function ye(){try{const t=await fetch("/api/auth/guest",{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Guest login failed");const e=await t.json();localStorage.setItem("loggedIn","true"),localStorage.setItem("username",e.name),localStorage.setItem("userId",e.id),localStorage.setItem("userEmail",e.email),he()}catch(t){console.error("Guest login failed:",t)}}function rt(t){var e=document.createElement("div");e.className="relative",e.style.height=`${t}px`;const n=3.5,a=`${n}px`,i=12,r=`${i}px`;var o=document.createElement("div");o.className="absolute top-0 bg-zinc-300",o.style.width=a,o.style.height="100%",o.style.left=r;var s=document.createElement("div");s.className="absolute bg-zinc-300",s.style.height=a,s.style.width=r,s.style.top="50%",s.style.left=`${i+n}px`,s.style.transform="translateY(-50%)";var d=document.createElement("div");d.className="absolute bg-zinc-300",d.style.height=a,d.style.width=r,d.style.top="0",d.style.left="0px";var l=document.createElement("div");return l.className="absolute bg-zinc-300",l.style.height=a,l.style.width=r,l.style.bottom="0",l.style.left="0px",e.appendChild(o),e.appendChild(s),e.appendChild(d),e.appendChild(l),e}function it(t){var e=document.createElement("div");e.className="relative",e.style.height=`${t}px`;const n=3.5,a=`${n}px`,i=12,r=`${i}px`;var o=document.createElement("div");o.className="absolute bg-zinc-300",o.style.top=`calc(50% - ${n/2}px)`,o.style.width=a,o.style.height=`calc(50% + ${n/2}px)`,o.style.left=r;var s=document.createElement("div");s.className="absolute bg-zinc-300",s.style.height=a,s.style.width=r,s.style.top="50%",s.style.left=`${i+n}px`,s.style.transform="translateY(-50%)";var d=document.createElement("div");return d.className="absolute bg-zinc-300",d.style.height=a,d.style.width=r,d.style.bottom="0",d.style.left="0px",e.appendChild(o),e.appendChild(s),e.appendChild(d),e}function lt(t,e,n){const a=document.createElement("div");a.className="flex flex-col top-0";const i=Math.floor((2*n-e)/2);t===0?a.style.marginTop=`${i*148+37}px`:a.style.marginTop=`${74*Math.pow(2,t-1)}px`;const r=Math.floor(e/2),o=74*Math.pow(2,t),s=74*Math.pow(2,t);if(e%2){const l=document.createElement("div"),c=it(o);l.appendChild(c),a.appendChild(l)}let d=0;for(;d<r;){const l=document.createElement("div");(d!==0||e%2)&&(l.style.marginTop=`${s}px`);const c=rt(o);l.appendChild(c),a.appendChild(l),d++}return a}function dt(t,e){const n=document.createElement("div"),a=t.p1_tag?t.p1_tag.toString().padStart(4,"0"):"...",i=t.p2_tag?t.p2_tag.toString().padStart(4,"0"):"...",r=t.p1_name?t.p1_name:"...",o=t.p2_name?t.p2_name:"...",s="border-l-4 border-green-500 pl-1",d="opacity-60 bg-zinc-400 border-l-4 border-red-600 pl-1",l="";var c,m;return t.winner===null?(c=l,m=l):t.winner===!0?(c=s,m=d):(c=d,m=s),n.innerHTML=`
	<div class="flex h-1/2">
		<div class="${c} text-black truncate flex-1 flex items-center justify-start px-2 font-semibold text-[13.5px]">
		${r}
	  	</div>
		
	${t.winner===!0?' <div class="text-yellow-400 px-1 flex items-center justify-center text-base">ï¿½ï¿½ï¿½</div>':""}

	  	<div class="text-zinc-300 tracking-wide bg-zinc-600 px-1 flex items-center justify-center w-11 text-[12px] font-bold font-mono">
	  		<span>#</span>${a}
		</div>

	</div>
	
	<div class="truncate flex h-1/2 border-t border-gray-200">
	  	<div class="${m} text-black flex-1 flex items-center justify-start px-2 font-semibold text-[13.5px]">
	  		${o}
	  	</div>
	  	<div class="text-zinc-300 tracking-wide bg-zinc-600 px-1 flex items-center justify-center w-11 text-[12px] font-bold font-mono">
	  		<span>#</span>${i}
		</div>
	</div>
	`,n.className="w-56 h-16 bg-white rounded shadow-md border border-gray-300 overflow-hidden transition-shadow duration-150 ease-in-out hover:shadow-lg hover:bg-gray-50 cursor-pointer",e&&(t.p1_id===e||t.p2_id===e)&&n.classList.add("border-2","border-blue-500"),n}function ct(t,e,n,a){const i=74*Math.pow(2,e)-64;var r;e===0?r=(2*n-t.length)*74+5:r=i/2;const o=document.createElement("div");o.className="relative flex flex-col items-center";let s=0;for(;s<t.length;){const d=t[s],l=document.createElement("div");l.style.marginTop=s===0?`${r}px`:`${i}px`;const c=dt(d,a);l.appendChild(c),o.appendChild(l),s++}return o.style.marginBottom=`${i/2}px`,o.style.marginLeft="30px",o}function ut(t,e,n,a,i){const r=document.getElementById("brackets-tournament-name");r&&(r.textContent=t);const o=document.getElementById("brackets-info-wrapper");if(o){var s;e==="RUNNING"?s="bg-yellow-400":e==="LOBBY"?s="bg-green-500":s="bg-red-500";const m=document.createElement("span");if(m.id="brackets-tournament-state",m.className=`w-5 h-5 rounded-full ${s}`,o.appendChild(m),n!=null){const u=document.createElement("h2");u.textContent=`ðŸ† Winner : ${n.name}#${n.tag.toString().padStart(4,"0")}`,u.className="ml-auto mr-10 text-xl font-bold text-yellow-600 bg-yellow-100 px-2 py-1 rounded",o.appendChild(u)}}const d=a.find(m=>m.round===1).matchs.length;var l=document.createElement("div");l.className="flex items-start";let c=0;for(;c<a.length;){const{round:m,matchs:u}=a[c],f=ct(u,m,d,i);if(l.appendChild(f),c<a.length-1){const w=lt(m,a[c].matchs.length,a[c+1].matchs.length);l.appendChild(w)}c++}return l}async function mt(t,e){const n=e||document.getElementById("brackets-container");if(!n)return null;if(!e){const a=document.getElementById("brackets-popup");a&&a.classList.remove("hidden")}try{n.innerHTML="",n.classList.remove("hidden"),n.innerHTML="<p>Loading brackets...</p>";const a=await fetch(`/api/tournaments/brackets/${t}`);if(!a.ok)throw console.error(`[loadBrackets] HTTP ${a.status}`),new Error(`Server error ${a.status}`);let i;try{n.innerHTML="",i=await a.json();const r=localStorage.getItem("userId");return n.appendChild(ut(i.tname,i.tstate,i.twinner!=null?{name:i.twinner_name,tag:i.twinner_tag}:null,i.brackets,r?parseInt(r,10):null)),i}catch(r){throw console.error("[loadBrackets] Invalid JSON:",r),new Error("Received non-JSON response")}}catch(a){return n.innerHTML="<p>Failed to load brackets...</p>",console.error("[loadBrackets]",a),null}}let X=[];async function Ce(t){X=t;const e=document.getElementById("tournament-table-body");if(e){e.innerHTML="";for(const n of t){const a=document.createElement("tr");a.dataset.tournamentId=n.id,a.innerHTML=`
      <td class="px-4 py-2">${n.id}</td>
      <td class="px-4 py-2">${n.name}</td>
      <td class="px-4 py-2">${n.owner_name}</td>
      <td class="px-4 py-2">${n.state}</td>
      <td class="px-4 py-2">${n.nbr_players}/${n.max_players}</td>
      <td class="px-4 py-2">${n.winner_name||""}</td>
      <td class="px-4 py-2 actions"></td>
    `,e.appendChild(a);const i=a.querySelector(".actions"),r=document.createElement("button");r.className="bg-blue-500 text-white px-2 py-1 rounded mr-2 join-btn",r.textContent="Join",i.appendChild(r);const o=document.createElement("button");o.className="bg-gray-500 text-white px-2 py-1 rounded spectate-btn",o.textContent="Spectate",i.appendChild(o);const s=document.createElement("button");s.className="bg-gray-500 text-white px-2 py-1 rounded ml-2 brackets-btn",s.textContent="Brackets",i.appendChild(s),e.appendChild(a)}}}function pt(){const t=document.getElementById("tournament-modal"),e=document.getElementById("tournament-modal-close"),n=document.getElementById("tournament-table-body"),a=()=>{t&&t.classList.add("hidden"),p("home")};t&&e&&(e.addEventListener("click",o=>{o.preventDefault(),a()}),t.addEventListener("click",o=>{o.target===t&&a()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&!t.classList.contains("hidden")&&a()})),C("home",()=>{t&&t.classList.add("hidden")}),Ie("dashboard-update",o=>{console.log("Received dashboard-update:",o),Ce(o)}),Ie("tournament-update",o=>{console.log("Received single tournament-update:",o);const s=X.findIndex(d=>d.id===o.id);s!==-1&&(X[s]=o,Ce(X))}),n&&n.addEventListener("click",async o=>{const s=o.target,d=s.closest("tr");if(!d)return;const l=Number(d.dataset.tournamentId),c=X.find(m=>m.id===l);if(c){if(s.classList.contains("join-btn")){const{showTournamentLobby:m}=await me(()=>import("./TournamentLobby-b7f2b857.js"),["assets/TournamentLobby-b7f2b857.js","assets/TournamentGame-eeb824a4.js"]),u=await ce();if(u)Le(l,u);else{console.error("Could not get user ID. Prompting guest login."),await ye();const f=await ce();if(!f){alert("Failed to login as guest. Cannot join tournament.");return}Le(l,f)}t&&t.classList.add("hidden"),m(l,c.name)}if(s.classList.contains("spectate-btn")){const{showTournamentLobby:m}=await me(()=>import("./TournamentLobby-b7f2b857.js"),["assets/TournamentLobby-b7f2b857.js","assets/TournamentGame-eeb824a4.js"]);console.log("Spectating tournament:",c),m(l,c.name,!0)}s.classList.contains("brackets-btn")&&await mt(l)}});const i=document.getElementById("play-tourn-btn");i&&t&&i.addEventListener("click",()=>{t.classList.remove("hidden"),p("tournament")});const r=document.getElementById("tournament-create-btn");r&&r.addEventListener("click",async()=>{const o=prompt("Enter tournament name:");if(!o)return;const s=await ce();if(!s){alert("You must be logged in to create a tournament.");return}Ze(o,s),alert("Tournament creation request sent.")})}function ft(){const t=document.getElementById("search-user"),e=document.getElementById("search-suggestions");if(t&&e){let n;t.addEventListener("input",()=>{const a=t.value.trim();if(window.clearTimeout(n),!a){e.innerHTML="",e.classList.add("hidden");return}n=window.setTimeout(async()=>{try{const i=await fetch(`/api/user/suggest/${encodeURIComponent(a)}`);if(!i.ok)throw new Error(`HTTP ${i.status}`);const r=await i.json();if(e.innerHTML="",r.success&&Array.isArray(r.suggestions))r.suggestions.forEach(o=>{const s=document.createElement("li");s.className="px-2 py-1 hover:bg-gray-600 cursor-pointer flex items-center",s.appendChild(document.createTextNode(o.name));const d=document.createElement("span");d.className="text-gray-400 text-sm ml-1",d.textContent=`#${o.tag}`,s.appendChild(d),s.addEventListener("click",()=>{e.classList.add("hidden"),t.value=o.name,pe(o.id)}),e.appendChild(s)});else{const o=document.createElement("li");o.textContent=r.msg||"No suggestions",o.className="px-2 py-1 text-gray-400",e.appendChild(o)}e.classList.remove("hidden")}catch(i){console.error("Suggest fetch error:",i)}},300)}),document.addEventListener("click",a=>{a.target!==t&&!e.contains(a.target)&&e.classList.add("hidden")})}else console.warn("Search input or suggestions list not found")}function gt(){const t=document.getElementById("signup-btn"),e=document.getElementById("signup-modal"),n=document.getElementById("signup-modal-form"),a=document.getElementById("signup-modal-close"),i=document.getElementById("signup-cancel-btn"),r=document.getElementById("signup-email"),o=document.getElementById("signup-name"),s=document.getElementById("signup-password"),d=document.getElementById("signup-confirm"),l=document.getElementById("signup-pass-feedback"),c=document.getElementById("google-signup-btn");if(!t||!e||!n||!a||!i||!r||!o||!s||!d||!l||!c)return;const m=()=>{e&&I(e),p("home")};t.addEventListener("click",u=>{u.preventDefault(),K(e),p("signup")}),a.addEventListener("click",u=>{u.preventDefault(),m()}),i.addEventListener("click",u=>{u.preventDefault(),m()}),e.addEventListener("click",u=>{u.target===e&&m()}),document.addEventListener("keydown",u=>{u.key==="Escape"&&e&&!e.classList.contains("hidden")&&m()}),C("home",()=>{e&&!e.classList.contains("hidden")&&I(e)}),s.addEventListener("input",()=>{const u=s.value,f=u.length>=8,w=/\d/.test(u),h=/[!@#$%^&*]/.test(u),L=/[A-Z]/.test(u);l.textContent=`Length: ${u.length} (${f?"âœ“":"âœ˜"}), Digit: ${w?"âœ“":"âœ˜"}, Special: ${h?"âœ“":"âœ˜"}, Uppercase: ${L?"âœ“":"âœ˜"}`}),n.addEventListener("submit",async u=>{u.preventDefault();const f=r.value,w=o.value,h=s.value,L=d.value;if(h!==L){alert("Passwords do not match");return}try{const T=await F("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f,name:w,password:h})});console.log("Signup response:",T),T&&T.response==="successfully logged in"?(I(e),localStorage.setItem("loggedIn","true"),localStorage.setItem("userEmail",f),je(),p("home")):alert(T.msg||"Signup failed")}catch(T){T instanceof Error&&T.message.includes("409")?alert("This email address is already in use."):(console.error("Signup error:",T),alert("An error occurred during signup. Please try again."))}}),c.addEventListener("click",u=>{u.preventDefault(),window.location.href="/api/auth/login/google"})}function ht(){const t=document.getElementById("profile-modal"),e=document.getElementById("profile-change-password-btn"),n=document.getElementById("change-password-modal"),a=document.getElementById("change-password-close"),i=document.getElementById("change-password-form"),r=document.getElementById("current-password"),o=document.getElementById("new-password"),s=document.getElementById("confirm-password");if(!n||!a||!i||!r||!o||!s||!e){console.warn("Missing change-password modal elements. Skipping setup.");return}e.addEventListener("click",d=>{d.preventDefault(),t&&t.classList.add("hidden"),n.classList.remove("hidden")}),a.addEventListener("click",d=>{d.preventDefault(),n.classList.add("hidden")}),n.addEventListener("click",d=>{d.target===n&&n.classList.add("hidden")}),document.addEventListener("keydown",d=>{d.key==="Escape"&&!n.classList.contains("hidden")&&n.classList.add("hidden")}),i.addEventListener("submit",async d=>{d.preventDefault();const l=r.value.trim(),c=o.value.trim(),m=s.value.trim();if(!l||!c||!m){alert("All fields are required");return}if(c!==m){alert("New passwords do not match");return}try{const u=await fetch("/api/auth/password",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:l,newPassword:c,confirmPassword:m})}),f=await u.json();u.ok?(alert(f.message||"Password changed successfully"),n.classList.add("hidden")):alert(f.error||"Failed to change password")}catch(u){console.error("Change password error:",u),alert("Error changing password")}})}const V=800,ue=450,fe=6,xe=10,ne=fe*4;function yt(t,e,n){var r;const a=document.getElementById("player-left-name"),i=document.getElementById("player-right-name");if(e.players?(a.textContent=e.players[0].id,i.textContent=e.players[1].id==="__PENDING__"?"Waiting...":e.players[1].id,a.classList.remove("hidden"),i.classList.remove("hidden")):(a.classList.add("hidden"),i.classList.add("hidden")),t.clearRect(0,0,V,ue),e.countdown&&e.countdown>0){const o=t.textAlign,s=t.textBaseline;t.fillStyle="white",t.font="48px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(`Starting in ${e.countdown}`,V/2,ue/2),t.textAlign=o,t.textBaseline=s;return}if(t.fillStyle="white",t.beginPath(),t.arc(e.ball.x,e.ball.y,fe,0,Math.PI*2),t.fill(),Array.isArray(e.bonusBalls)&&e.bonusBalls.forEach(o=>{const s=n[o.type];s!=null&&s.complete&&t.drawImage(s,o.x-ne,o.y-ne,ne*2,ne*2)}),e.players.forEach(o=>{const s=o.side==="left"?0:V-xe;o.power.includes("s")&&(t.fillStyle="gold",t.fillRect(s,0,xe,ue)),t.fillStyle="white";let d=o.power.length-1;for(;d>=0&&(o.power[d]==="s"||o.power[d]==="f");)d--;o.power[d]==="i"?t.fillStyle="purple":o.power[d]==="v"?t.fillStyle="blue":o.power[d]==="b"&&(t.fillStyle="red"),t.fillRect(s,o.paddle.y,o.paddle.w,o.paddle.h)}),(r=e.phantomBalls)==null||r.forEach(o=>{t.fillStyle="white",t.beginPath(),t.arc(o.x,o.y,fe,0,Math.PI*2),t.fill()}),t.fillStyle="white",t.font="20px sans-serif",t.fillText(e.players[0].score,V/4,20),t.fillText(e.players[1].score,V*3/4,20),e.timer!=null){t.fillStyle="white",t.font="16px sans-serif",t.textAlign="center";const o=Math.floor(e.timer/60),s=Math.floor(o/60),l=(o%60).toString().padStart(2,"0");t.fillText(`Time: ${s}:${l}`,V/2,40),t.textAlign="left"}}const Fe={fake:"./fake.png",speedUp:"./speed.png",shield:"./shield.png",bigger:"./bigger.png"},Oe={};function Re(t,e){return new Promise((n,a)=>{const i=new Image;i.src=e,i.onload=()=>{Oe[t]=i,n()},i.onerror=r=>{console.error(`âŒ Erreur de chargement de l'image "${t}" depuis "${e}"`,r),a(new Error(`Impossible de charger l'image "${t}"`))}})}const y=document.getElementById("game-canvas"),Te=document.getElementById("canvas-wrapper"),qe=y==null?void 0:y.getContext("2d"),_=document.getElementById("hero"),O=document.getElementById("game-result"),E=document.getElementById("forfeit-btn"),ve=document.getElementById("play-ai-btn"),we=document.getElementById("play-pvp-btn"),vt=document.getElementById("ai-difficulty"),wt=document.getElementById("custom-toggle"),Et=document.getElementById("pvp-menu"),It=document.getElementById("pvp-create-btn"),Lt=document.getElementById("pvp-join-btn"),bt=document.getElementById("pvp-join-input"),kt=document.getElementById("pvp-join-confirm-btn"),H=document.getElementById("share-id"),Ee=document.getElementById("game-id-input"),M=document.getElementById("pvp-modal"),Ge=document.getElementById("pvp-modal-close"),Ue=document.getElementById("pvp-modal-create-btn"),We=document.getElementById("pvp-modal-join-input"),Je=document.getElementById("pvp-modal-join-confirm-btn"),He=document.getElementById("pvp-modal-custom-toggle"),A=document.getElementById("ai-modal"),ze=document.getElementById("ai-modal-close"),Ye=document.getElementById("ai-modal-difficulty"),Ve=document.getElementById("ai-modal-custom-toggle"),Ke=document.getElementById("ai-modal-start-btn");(!y||!qe||!_||!O||!E||!ve||!we||!vt||!wt||!Et||!It||!Lt||!bt||!kt||!H||!Ee||!M||!Ge||!Ue||!We||!Je||!He||!A||!ze||!Ye||!Ve||!Ke)&&console.error("Missing game controller elements");let v="",D="",N="",z=null,S;function ge(t){!v||!D||t===z||(z=t,fetch(`/api/game/${v}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:D,type:t,ts:Date.now(),token:N})}).catch(console.error))}function Pe(){!v||!D||fetch(`/api/game/${v}/input`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:D,type:"forfeit",ts:Date.now(),token:N})}).catch(console.error)}function W(t){t.key==="ArrowUp"&&ge("move_up"),t.key==="ArrowDown"&&ge("move_down")}function J(t){(t.key==="ArrowUp"||t.key==="ArrowDown")&&ge("stop")}const re=1e3/60;async function R(){var t;if(!location.hash.startsWith("#game/")){S&&(clearInterval(S),S=void 0,window.removeEventListener("keydown",W),window.removeEventListener("keyup",J),_.classList.remove("hidden"),y.classList.add("hidden"),q(!1),E.classList.add("hidden"),H.classList.add("hidden"));return}try{const e=await fetch(`/api/game/${v}/state`);if(!e.ok)throw new Error(`HTTP ${e.status} on render state`);const n=await e.json();if(yt(qe,n,Oe),n.isGameOver&&S!==void 0){clearInterval(S),S=void 0,z=null,document.fullscreenElement&&((t=document.exitFullscreen)==null||t.call(document));const a=n.winner,i=n.players.find(d=>d.side===a);O.classList.remove("hidden"),O.textContent=`Game Over â€” winner: ${i?i.id:"Unknown"}`;const r=document.getElementById("player-left-name"),o=document.getElementById("player-right-name");if(r&&r.classList.add("hidden"),o&&o.classList.add("hidden"),localStorage.getItem("currentGameType")==="tournament"){const d=localStorage.getItem("currentTournamentId");if(d){const{showTournamentGame:l}=await me(()=>import("./TournamentGame-eeb824a4.js"),[]);l(parseInt(d,10))}}else _.classList.remove("hidden"),y.classList.add("hidden");q(!1),E.classList.add("hidden"),H.classList.add("hidden"),localStorage.removeItem("gameId"),localStorage.removeItem("playerId"),localStorage.removeItem("authToken"),localStorage.removeItem("mode"),localStorage.removeItem("currentGameType"),localStorage.removeItem("currentTournamentId")}}catch(e){console.error("[fetchAndDraw]",e)}}async function $e(t,e){await Promise.all(Object.entries(Fe).map(([n,a])=>Re(n,a))),q(!0),_.classList.add("hidden"),O.classList.add("hidden"),y.classList.remove("hidden"),y.focus(),z=null;try{const n=t==="ai"?Ve.checked:He.checked;let a=localStorage.getItem("username");if(!a&&(await ye(),a=localStorage.getItem("username"),!a)){console.error("Failed to login as guest.");return}const i={mode:t,isCustomOn:n,username:a};e&&(i.difficulty=e);const o=await(await fetch("/api/game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();v=o.gameId,D=o.playerId,N=o.token,localStorage.setItem("gameId",v),localStorage.setItem("playerId",D),localStorage.setItem("authToken",N),localStorage.setItem("mode",t),e&&localStorage.setItem("difficulty",e),p("game",{id:v}),H.classList.toggle("hidden",t!=="pvp"),t==="pvp"&&(Ee.value=v),await R(),S=window.setInterval(R,re),window.addEventListener("keydown",W),window.addEventListener("keyup",J),E.classList.remove("hidden"),E.disabled=!1}catch(n){console.error("[startGame]",n),q(!1)}}function q(t){ve.disabled=t,we.disabled=t}function Mt(t){v=t;const e=localStorage.getItem("userId");if(!e){console.error("Cannot start game: user not logged in.");return}D=e,N=localStorage.getItem("authToken"),p("game",{id:t}),y&&_&&O&&E&&(y.classList.remove("hidden"),_.classList.add("hidden"),O.classList.add("hidden"),E.classList.remove("hidden"),E.disabled=!1),q(!0),y.focus(),z=null,R(),S=window.setInterval(R,re),window.addEventListener("keydown",W),window.addEventListener("keyup",J)}function Bt(){E.addEventListener("click",e=>{e.preventDefault(),Pe(),E.disabled=!0}),window.addEventListener("keydown",W),window.addEventListener("keyup",J),ve.addEventListener("click",e=>{e.preventDefault(),p("play-ai")}),ze.addEventListener("click",e=>{e.preventDefault(),p("home")}),A.addEventListener("click",e=>{e.target===A&&p("home")}),window.addEventListener("keydown",e=>{e.key==="Escape"&&!A.classList.contains("hidden")&&p("home")}),C("play-ai",()=>{A.classList.remove("hidden")}),C("home",()=>{A&&!A.classList.contains("hidden")&&A.classList.add("hidden")}),Ke.addEventListener("click",e=>{e.preventDefault(),A.classList.add("hidden");const n=Ye.value;$e("ai",n)}),we.addEventListener("click",e=>{e.preventDefault(),p("play-pvp")}),Ge.addEventListener("click",e=>{e.preventDefault(),p("home")}),M.addEventListener("click",e=>{e.target===M&&p("home")}),window.addEventListener("keydown",e=>{e.key==="Escape"&&!M.classList.contains("hidden")&&p("home")}),C("play-pvp",()=>{M.classList.remove("hidden")}),C("home",()=>{M&&!M.classList.contains("hidden")&&M.classList.add("hidden")}),Ue.addEventListener("click",e=>{e.preventDefault(),M.classList.add("hidden"),$e("pvp")}),Je.addEventListener("click",async e=>{e.preventDefault();const n=We.value.trim();if(!n){alert("Please enter a game ID to join");return}let a=localStorage.getItem("username");if(!a&&(await ye(),a=localStorage.getItem("username"),!a)){console.error("Failed to login as guest.");return}try{await Promise.all(Object.entries(Fe).map(([o,s])=>Re(o,s)));const i=await fetch(`/api/game/${n}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a})}),r=await i.json();if(!i.ok){alert(r.error||"Failed to join game");return}v=r.gameId,D=r.playerId,N=r.token,localStorage.setItem("gameId",v),localStorage.setItem("playerId",D),localStorage.setItem("authToken",N),localStorage.setItem("mode","pvp"),p("game",{id:v}),M.classList.add("hidden"),q(!0),_.classList.add("hidden"),O.classList.add("hidden"),H.classList.add("hidden"),y.classList.remove("hidden"),y.focus(),z=null,await R(),S=window.setInterval(R,re),window.addEventListener("keydown",W),window.addEventListener("keyup",J),E.classList.remove("hidden"),E.disabled=!1}catch(i){console.error("Error joining PvP game:",i),alert("Error joining game")}}),window.addEventListener("hashchange",()=>{const e=location.hash.match(/^#game\/(.+)$/);if(e){const n=localStorage.getItem("gameId");n===e[1]&&(v=n,D=localStorage.getItem("playerId"),N=localStorage.getItem("authToken"),De())}});const t=location.hash.match(/^#game\/(.+)$/);if(t){const e=localStorage.getItem("gameId");e===t[1]&&(v=e,D=localStorage.getItem("playerId"),N=localStorage.getItem("authToken"),De())}C("home",()=>{S&&(Pe(),clearInterval(S),S=void 0,window.removeEventListener("keydown",W),window.removeEventListener("keyup",J),_.classList.remove("hidden"),y.classList.add("hidden"),q(!1),E.classList.add("hidden"),H.classList.add("hidden"))})}function De(){q(!0),_.classList.add("hidden"),O.classList.add("hidden"),y.classList.remove("hidden"),y.focus(),z=null;const t=localStorage.getItem("mode");H.classList.toggle("hidden",t!=="pvp"),t==="pvp"&&(Ee.value=v),R(),S=window.setInterval(R,re),window.addEventListener("keydown",W),window.addEventListener("keyup",J),E.classList.remove("hidden"),E.disabled=!1}function At(){y&&Te&&Te.appendChild(y)}function St(){var L,T;const t=document.getElementById("profile-btn"),e=document.getElementById("profile-modal"),n=document.getElementById("profile-modal-close"),a=document.getElementById("profile-username"),i=document.getElementById("profile-email"),r=document.getElementById("profile-avatar"),o=document.getElementById("profile-id"),s=document.getElementById("profile-online-status"),d=document.getElementById("profile-2fa-status"),l=document.getElementById("profile-setup-2fa-btn"),c=document.getElementById("profile-disable-2fa-btn"),m=document.getElementById("profile-na-2fa-btn"),u=document.getElementById("profile-change-password-btn"),f=document.createElement("button");if(f.id="profile-delete-btn",f.className="px-4 py-2 bg-red-700 rounded text-white mt-4",f.textContent="Delete Profile",u&&((L=u.parentElement)==null||L.appendChild(f)),!t||!e||!n||!a||!i||!r||!o||!s||!d||!l||!c||!m||!u){console.error("Missing profile modal elements");return}t.addEventListener("click",async g=>{if(g.preventDefault(),!(localStorage.getItem("loggedIn")==="true")){window.location.hash="#login";return}const k=localStorage.getItem("userEmail");if(!k){alert("Could not find user email. Please log in again.");return}try{const j=await fetch(`/api/user/lookup/${encodeURIComponent(k)}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!j.ok)throw new Error(await j.text());const P=await j.json();a.textContent=P.name,i.textContent=P.email,o.textContent=P.id.toString(),s.textContent=P.online?"true":"false",P.twofa_secret&&P.twofa_validated?(d.textContent="true",l.classList.add("hidden"),c.classList.remove("hidden")):(d.textContent="false",l.classList.remove("hidden"),c.classList.add("hidden")),m.classList.add("hidden"),r&&(P.avatar?(r.src=P.avatar,r.classList.remove("hidden")):r.classList.add("hidden")),e.classList.remove("hidden"),p("profile")}catch(j){console.error("Profile lookup error:",j)}}),n.addEventListener("click",g=>{g.preventDefault(),p("home")}),e.addEventListener("click",g=>{g.target===e&&p("home")}),document.addEventListener("keydown",g=>{g.key==="Escape"&&!e.classList.contains("hidden")&&p("home")}),C("home",()=>{e&&!e.classList.contains("hidden")&&e.classList.add("hidden")}),l.addEventListener("click",g=>{g.preventDefault(),e.classList.add("hidden"),p("setup-2fa")}),u.addEventListener("click",g=>{g.preventDefault(),e.classList.add("hidden"),p("change-password")}),c.addEventListener("click",async g=>{g.preventDefault();try{const x=await fetch("/api/auth/2fa/delete",{method:"DELETE",credentials:"include"}),k=await x.json();x.ok?(alert(k.message||"2FA disabled. You will now be logged out."),localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),localStorage.removeItem("userEmail"),localStorage.removeItem("twofaEnabled"),window.location.reload()):alert(k.error||"Disable 2FA failed")}catch(x){console.error("Disable 2FA error:",x),alert("Error disabling 2FA")}});const w=document.getElementById("profile-upload-avatar-btn"),h=document.getElementById("avatar-file-input");if(w&&h){const g=document.createElement("img");g.style.maxWidth="150px",g.style.marginTop="10px",g.style.borderRadius="8px",g.style.display="block",(T=w.parentElement)==null||T.appendChild(g),w.addEventListener("click",()=>h.click()),h.addEventListener("change",async x=>{const k=x.target;if(k.files&&k.files[0]){const j=k.files[0],P=new FileReader;P.onload=G=>{var Z;(Z=G.target)!=null&&Z.result&&(g.src=G.target.result)},P.readAsDataURL(j);try{const G=new FormData;G.append("avatar",j);const Z=await fetch("/api/user/upload_avatar",{method:"POST",credentials:"include",body:G});let Y;try{Y=await Z.json()}catch{}Z.ok&&Y.avatar?(g.src=Y.avatar,alert("Avatar uploaded successfully")):alert(Y&&(Y.error||Y.msg)||"Upload failed")}catch(G){console.error("Avatar upload error:",G),alert("Error uploading avatar")}}})}f.addEventListener("click",async()=>{const g=localStorage.getItem("userEmail");if(!g){alert("Cannot delete profile without user email.");return}if(confirm("Are you sure you want to delete your profile? This action is irreversible."))try{const x=await fetch(`/api/user/delete/${encodeURIComponent(g)}`,{method:"DELETE",credentials:"include"}),k=await x.json();x.ok&&k.success?(alert(k.message||"Profile deleted successfully. You will be logged out."),localStorage.clear(),window.location.reload()):alert(k.error||"Failed to delete profile.")}catch(x){console.error("Delete profile error:",x),alert("An error occurred while deleting your profile.")}})}function Ct(){var t=document.getElementById("brackets-popup");if(t){t.classList.add("hidden");var e=document.getElementById("brackets-container");if(e){e.innerHTML="";var n=document.getElementById("brackets-tournament-state");n&&n.remove()}}}function xt(){if(!document.getElementById("brackets-popup")||!document.getElementById("brackets-container"))return;const n=document.getElementById("close-brackets");n&&n.addEventListener("click",Ct)}document.addEventListener("DOMContentLoaded",()=>{Xe(),gt(),ht(),je(),ft(),at(),pt(),Bt(),St(),ot(),xt(),Me()});nt();_e();export{ce as a,mt as b,At as c,Tt as d,Pt as g,$t as l,p as n,Ie as o,Mt as p,Dt as s};

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const d of n)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function i(n){const d={};return n.integrity&&(d.integrity=n.integrity),n.referrerPolicy&&(d.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?d.credentials="include":n.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(n){if(n.ep)return;n.ep=!0;const d=i(n);fetch(n.href,d)}})();const g=800,x=450,y=10,T=80,X=6,B=document.getElementById("login-btn"),k=document.getElementById("play-ai-btn"),b=document.getElementById("play-pvp-btn"),D=document.getElementById("play-tourn-btn"),r=document.getElementById("ai-difficulty"),o=document.getElementById("game-canvas"),O=document.getElementById("hero"),p=document.getElementById("game-result");if(!B||!k||!b||!D||!r||!o||!O||!p)throw document.getElementById("app").innerHTML='<div class="text-red-500 p-4">Missing required DOM elements</div>',new Error("Missing DOM");const c=document.getElementById("login-modal"),C=document.getElementById("login-modal-form"),G=document.getElementById("login-modal-close"),$=document.getElementById("login-email"),F=document.getElementById("login-password"),_=document.getElementById("google-login-btn"),N=document.getElementById("guest-login-btn");if(!c||!C||!G||!$||!F||!_||!N)throw new Error("Missing login modal elements");o.width=g;o.height=x;const l=o.getContext("2d");let P="",E="",f=null,m;function Y(e){l.fillStyle="black",l.fillRect(0,0,g,x),l.fillStyle="white";const[t,i]=e.players;l.fillRect(0,t.paddle.y,y,T),l.fillRect(g-y,i.paddle.y,y,T),l.beginPath(),l.arc(e.ball.x,e.ball.y,X,0,2*Math.PI),l.fill(),l.font="30px sans-serif",l.fillText(String(t.score),g*.25,40),l.fillText(String(i.score),g*.75,40)}function L(e){!P||!E||e===f||(f=e,fetch("http://localhost:3001/api/game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:E,type:e,ts:Date.now()})}).catch(console.error))}function Z(e){e.key==="ArrowUp"&&L("move_up"),e.key==="ArrowDown"&&L("move_down")}function ee(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&L("stop")}const te=100;async function A(){try{const e=await fetch(`/api/game/${P}/state`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();Y(t),t.isGameOver&&m&&(clearInterval(m),m=void 0,f=null,document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),p.classList.remove("hidden"),p.textContent=`Game Over — winner: ${t.winner}`,O.classList.remove("hidden"),o.classList.add("hidden"),I(!1))}catch(e){console.error("[fetchAndDraw]",e)}}async function S(e,t){I(!0),O.classList.add("hidden"),p.classList.add("hidden"),o.classList.remove("hidden"),o.focus(),f=null;try{const n=await(await fetch("http://localhost:3001/api/game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:e,difficulty:t})})).json();P=n.gameId,E=n.playerId,await A(),m=window.setInterval(A,te),window.addEventListener("keydown",Z),window.addEventListener("keyup",ee)}catch(i){console.error("[startGame]",i),I(!1)}}function I(e){k.disabled=e,b.disabled=e,D.disabled=e,B.disabled=e}B.addEventListener("click",e=>{e.preventDefault(),c.classList.remove("hidden")});G.addEventListener("click",e=>{e.preventDefault(),c.classList.add("hidden")});C.addEventListener("submit",async e=>{e.preventDefault();const t=$.value,i=F.value;try{(await fetch("http://localhost:3001/api/game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:i})})).ok?(localStorage.setItem("loggedIn","true"),window.location.reload()):alert("Login failed")}catch(s){console.error(s),alert("Login error")}});_.addEventListener("click",e=>{e.preventDefault(),window.location.href="/api/auth/login/google"});N.addEventListener("click",e=>{e.preventDefault(),console.warn("Guest login not implemented"),localStorage.setItem("loggedIn","true"),localStorage.setItem("username","Guest"),M()});document.addEventListener("keydown",e=>{e.key==="Escape"&&!c.classList.contains("hidden")&&c.classList.add("hidden")});c.addEventListener("click",e=>{e.target===c&&c.classList.add("hidden")});const H=document.getElementById("signup-btn"),a=document.getElementById("signup-modal"),j=document.getElementById("signup-modal-form"),q=document.getElementById("signup-modal-close"),U=document.getElementById("signup-cancel-btn"),R=document.getElementById("signup-email"),J=document.getElementById("signup-name"),h=document.getElementById("signup-password"),K=document.getElementById("signup-pass-feedback"),V=document.getElementById("signup-confirm");if(!H||!a||!j||!q||!U||!R||!J||!h||!K||!V)throw new Error("Missing signup modal elements");h.addEventListener("input",()=>{const e=h.value,t=e.length>=8,i=/\d/.test(e),s=/[!@#$%^&*]/.test(e);K.textContent=`Length: ${e.length} (${t?"✓":"✘"}), Digit: ${i?"✓":"✘"}, Special: ${s?"✓":"✘"}`});const w=document.getElementById("auth-user"),v=document.getElementById("auth-guest"),W=document.getElementById("logout-btn"),z=document.getElementById("user-greeting");if(!w||!v||!W||!z)throw new Error("Missing auth containers");function M(){localStorage.getItem("loggedIn")==="true"?(w.classList.remove("hidden"),v.classList.add("hidden"),z.textContent=localStorage.getItem("username")||"Player"):(w.classList.add("hidden"),v.classList.remove("hidden"))}W.addEventListener("click",e=>{e.preventDefault(),localStorage.removeItem("loggedIn"),localStorage.removeItem("username"),M()});M();H.addEventListener("click",e=>{e.preventDefault(),a.classList.remove("hidden")});q.addEventListener("click",e=>{e.preventDefault(),a.classList.add("hidden")});U.addEventListener("click",e=>{e.preventDefault(),a.classList.add("hidden")});document.addEventListener("keydown",e=>{e.key==="Escape"&&a&&!a.classList.contains("hidden")&&a.classList.add("hidden")});a.addEventListener("click",e=>{e.target===a&&a.classList.add("hidden")});j.addEventListener("submit",e=>{e.preventDefault();const t=R.value,i=J.value,s=h.value,n=V.value,d=s.length>=8,u=/\d/.test(s),Q=/[!@#$%^&*]/.test(s);if(!d||!u||!Q){alert("Password must be at least 8 characters and include a number and special character.");return}if(s!==n){alert("Passwords do not match");return}console.log("Sign Up data:",{email:t,username:i,password:s}),a.classList.add("hidden")});k.addEventListener("click",()=>{var t;if(r.classList.toggle("hidden"),!r.classList.contains("hidden"))return;const e=r.value;(t=o.requestFullscreen)==null||t.call(o).catch(()=>{}),S("ai",e)});b.addEventListener("click",()=>{var e;r.classList.add("hidden"),(e=o.requestFullscreen)==null||e.call(o).catch(()=>{}),S("pvp")});D.addEventListener("click",()=>{var e;r.classList.add("hidden"),(e=o.requestFullscreen)==null||e.call(o).catch(()=>{}),S("tournament")});

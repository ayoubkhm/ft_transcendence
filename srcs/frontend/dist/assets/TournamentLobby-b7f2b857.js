import{o as y,g as v,a as h,l as T,n as g,s as B,d as I}from"./index-c2e6b725.js";import{showTournamentGame as C}from"./TournamentGame-eeb824a4.js";const m=document.getElementById("tournament-lobby-modal");document.getElementById("tournament-lobby-close");const x=document.getElementById("tournament-lobby-title"),b=document.getElementById("tournament-lobby-state"),L=document.getElementById("tournament-lobby-player-count"),l=document.getElementById("tournament-lobby-players"),p=document.getElementById("tournament-lobby-leave-btn"),E=document.getElementById("tournament-lobby-start-btn"),f=document.getElementById("tournament-lobby-delete-btn");let s=null,a=null;async function c(){if(confirm("Leaving the lobby will remove you from the tournament. Are you sure?")){if(!s)return;const n=h();if(!n){alert("You must be logged in to leave a tournament.");return}T(s,n),m.classList.add("hidden"),setTimeout(()=>{g("tournament")},100)}}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("tournament-lobby-modal"),d=document.getElementById("tournament-lobby-close"),e=document.getElementById("tournament-lobby-leave-btn"),r=document.getElementById("tournament-lobby-start-btn"),o=document.getElementById("tournament-lobby-delete-btn");d&&d.addEventListener("click",t=>{t.preventDefault(),c()}),n&&n.addEventListener("click",t=>{t.target===n&&c()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&n&&!n.classList.contains("hidden")&&c()}),e&&e.addEventListener("click",c),r&&r.addEventListener("click",()=>{a&&B(a)}),o&&o.addEventListener("click",()=>{a&&confirm(`Are you sure you want to delete the tournament "${a}"?`)&&I(a)})});async function M(n,d){s=n,a=d,x.textContent=`Lobby for ${d}`,l.innerHTML='<tr><td colspan="2" class="text-center py-4">Loading...</td></tr>',b.textContent="Loading...",L.textContent="Loading...",E.classList.add("hidden"),f.classList.add("hidden"),p.classList.remove("hidden"),m.classList.remove("hidden"),y("tournament-update",e=>{if(e.id!==s)return;if(b.textContent=e.state,L.textContent=`${e.nbr_players}/${e.max_players}`,l.innerHTML="",e.players.length===0){const o=document.createElement("tr"),t=document.createElement("td");t.colSpan=2,t.textContent="No players have joined yet.",t.className="text-center py-4",o.appendChild(t),l.appendChild(o)}else e.players.forEach(o=>{const t=document.createElement("tr"),u=document.createElement("td");u.textContent=o.name,u.className="px-2 py-1";const i=document.createElement("td");i.textContent="âœ…",i.className="px-2 py-1",t.appendChild(u),t.appendChild(i),l.appendChild(t)});const r=h();r&&r===e.owner_id&&(E.classList.remove("hidden"),f.classList.remove("hidden"),p.classList.add("hidden")),(e.state==="IN_PROGRESS"||e.state==="OVER")&&(m&&m.classList.add("hidden"),C(e.id))}),y("tournament-deleted",e=>{e.tournament_id===s&&(alert("The tournament has been deleted by the owner."),m.classList.add("hidden"),g("home"))}),v(n)}export{M as showTournamentLobby};
